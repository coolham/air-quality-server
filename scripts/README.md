# Scripts ç›®å½•è¯´æ˜

æœ¬ç›®å½•åŒ…å«ç©ºæ°”è´¨é‡ç›‘æµ‹ç³»ç»Ÿçš„å„ç§ç®¡ç†è„šæœ¬ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»ç»„ç»‡ï¼Œä¾¿äºç®¡ç†å’Œä½¿ç”¨ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ app/                    # åº”ç”¨ç¨‹åºç®¡ç†
â”‚   â”œâ”€â”€ build-app.bat      # æ„å»ºåº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ run-app.bat        # è¿è¡Œå·²æ„å»ºçš„åº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ start-app.bat      # å¼€å‘æ¨¡å¼å¯åŠ¨
â”‚   â””â”€â”€ setup.bat          # ä¸€é”®å®‰è£…è„šæœ¬
â”œâ”€â”€ database/              # æ•°æ®åº“ç®¡ç†
â”‚   â”œâ”€â”€ init-database.bat  # Goè¿ç§»å·¥å…·åˆå§‹åŒ–
â”‚   â”œâ”€â”€ init-database-sql.bat # SQLè„šæœ¬åˆå§‹åŒ–
â”‚   â”œâ”€â”€ check-database.bat # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
â”‚   â””â”€â”€ init.sql           # æ•°æ®åº“åˆå§‹åŒ–SQLè„šæœ¬
â”œâ”€â”€ docker/                # Dockerç®¡ç†
â”‚   â”œâ”€â”€ docker-start.bat   # å¯åŠ¨DockeræœåŠ¡
â”‚   â”œâ”€â”€ docker-start.sh    # Linuxç‰ˆæœ¬å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ docker-dev-start.bat # å¼€å‘ç¯å¢ƒå¯åŠ¨
â”‚   â”œâ”€â”€ docker-dev-start.sh  # Linuxå¼€å‘ç¯å¢ƒå¯åŠ¨
â”‚   â””â”€â”€ docker-stop.sh     # åœæ­¢DockeræœåŠ¡
â”œâ”€â”€ firewall/              # é˜²ç«å¢™ç®¡ç†
â”‚   â”œâ”€â”€ configure_firewall.bat # é…ç½®é˜²ç«å¢™è§„åˆ™
â”‚   â”œâ”€â”€ remove_firewall_rules.bat # ç§»é™¤é˜²ç«å¢™è§„åˆ™
â”‚   â”œâ”€â”€ check_firewall_rules.ps1 # æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
â”‚   â””â”€â”€ start_with_firewall.bat # å¸¦é˜²ç«å¢™å¯åŠ¨
â”œâ”€â”€ test/                  # æµ‹è¯•ä¸è°ƒè¯•
â”‚   â”œâ”€â”€ run-tests.bat      # è¿è¡Œå•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test-config.go     # é…ç½®è·¯å¾„æµ‹è¯•
â”‚   â”œâ”€â”€ test-mqtt-storage.bat # MQTTå­˜å‚¨æµ‹è¯•
â”‚   â””â”€â”€ test-web-data.bat  # Webæ•°æ®æµ‹è¯•
â””â”€â”€ docs/                  # æ–‡æ¡£
    â””â”€â”€ README.md          # æœ¬è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### é¦–æ¬¡éƒ¨ç½²

#### æ–¹æ³•1ï¼šä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰
```cmd
scripts\app\setup.bat
```

#### æ–¹æ³•2ï¼šåˆ†æ­¥å®‰è£…
```cmd
# 1. æ„å»ºåº”ç”¨ç¨‹åº
scripts\app\build-app.bat

# 2. åˆå§‹åŒ–æ•°æ®åº“
scripts\database\init-database-sql.bat

# 3. é…ç½®é˜²ç«å¢™
scripts\firewall\configure_firewall.bat

# 4. å¯åŠ¨åº”ç”¨ç¨‹åº
scripts\app\start-app.bat
```

### æ—¥å¸¸å¼€å‘
```cmd
# å¼€å‘æ¨¡å¼å¯åŠ¨
scripts\app\start-app.bat

# æˆ–å¸¦é˜²ç«å¢™å¯åŠ¨
scripts\firewall\start_with_firewall.bat
```

### ç”Ÿäº§éƒ¨ç½²
```cmd
# æ„å»ºåº”ç”¨ç¨‹åº
scripts\app\build-app.bat

# è¿è¡Œåº”ç”¨ç¨‹åº
scripts\app\run-app.bat
```

## ğŸ“‹ åŠŸèƒ½åˆ†ç±»è¯¦è§£

### ğŸ–¥ï¸ åº”ç”¨ç¨‹åºç®¡ç† (app/)

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `setup.bat` | ä¸€é”®å®‰è£…è„šæœ¬ | é¦–æ¬¡éƒ¨ç½²ï¼Œè‡ªåŠ¨å®Œæˆç¯å¢ƒæ£€æŸ¥ã€ä¾èµ–ä¸‹è½½ã€æ•°æ®åº“åˆå§‹åŒ–ã€åº”ç”¨æ„å»º |
| `build-app.bat` | æ„å»ºåº”ç”¨ç¨‹åº | ç¼–è¯‘Goä»£ç ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ |
| `start-app.bat` | å¼€å‘æ¨¡å¼å¯åŠ¨ | ç›´æ¥è¿è¡ŒGoä»£ç ï¼Œé€‚åˆå¼€å‘è°ƒè¯• |
| `run-app.bat` | è¿è¡Œåº”ç”¨ç¨‹åº | è¿è¡Œå·²æ„å»ºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ |

### ğŸ—„ï¸ æ•°æ®åº“ç®¡ç† (database/)

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `init-database-sql.bat` | SQLè„šæœ¬åˆå§‹åŒ– | ä½¿ç”¨SQLè„šæœ¬åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æ„ï¼ˆæ¨èï¼‰ |
| `init-database.bat` | Goè¿ç§»å·¥å…·åˆå§‹åŒ– | ä½¿ç”¨Goè¿ç§»å·¥å…·åˆ›å»ºè¡¨ç»“æ„ |
| `check-database.bat` | æ£€æŸ¥æ•°æ®åº“çŠ¶æ€ | éªŒè¯æ•°æ®åº“åˆå§‹åŒ–ç»“æœï¼Œæ˜¾ç¤ºè¡¨ç»“æ„å’Œæ•°æ®ç»Ÿè®¡ |
| `init.sql` | æ•°æ®åº“åˆå§‹åŒ–SQLè„šæœ¬ | åŒ…å«æ‰€æœ‰è¡¨ç»“æ„å’Œåˆå§‹æ•°æ®çš„SQLè„šæœ¬ |

### ğŸ³ Dockerç®¡ç† (docker/)

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `docker-start.bat` | å¯åŠ¨DockeræœåŠ¡ | ç”Ÿäº§ç¯å¢ƒDockeréƒ¨ç½² |
| `docker-start.sh` | Linuxå¯åŠ¨è„šæœ¬ | Linuxç¯å¢ƒDockeréƒ¨ç½² |
| `docker-dev-start.bat` | å¼€å‘ç¯å¢ƒå¯åŠ¨ | å¼€å‘ç¯å¢ƒDockeréƒ¨ç½² |
| `docker-dev-start.sh` | Linuxå¼€å‘ç¯å¢ƒå¯åŠ¨ | Linuxå¼€å‘ç¯å¢ƒDockeréƒ¨ç½² |
| `docker-stop.sh` | åœæ­¢DockeræœåŠ¡ | åœæ­¢æ‰€æœ‰Dockerå®¹å™¨ |

### ğŸ”¥ é˜²ç«å¢™ç®¡ç† (firewall/)

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `configure_firewall.bat` | é…ç½®é˜²ç«å¢™è§„åˆ™ | ä¸ºåº”ç”¨ç¨‹åºå’ŒMQTTç«¯å£æ·»åŠ é˜²ç«å¢™è§„åˆ™ |
| `remove_firewall_rules.bat` | ç§»é™¤é˜²ç«å¢™è§„åˆ™ | æ¸…ç†ä¹‹å‰æ·»åŠ çš„é˜²ç«å¢™è§„åˆ™ |
| `check_firewall_rules.ps1` | æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ | æŸ¥çœ‹ç°æœ‰çš„é˜²ç«å¢™è§„åˆ™çŠ¶æ€ |
| `start_with_firewall.bat` | å¸¦é˜²ç«å¢™å¯åŠ¨ | è‡ªåŠ¨é…ç½®é˜²ç«å¢™å¹¶å¯åŠ¨åº”ç”¨ç¨‹åº |

### ğŸ§ª æµ‹è¯•ä¸è°ƒè¯• (test/)

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `run-tests.bat` | è¿è¡Œå•å…ƒæµ‹è¯• | æ‰§è¡ŒGoå•å…ƒæµ‹è¯•ï¼ŒéªŒè¯ä»£ç è´¨é‡ |
| `test-config.go` | é…ç½®è·¯å¾„æµ‹è¯• | æµ‹è¯•é…ç½®æ–‡ä»¶è·¯å¾„è§£æï¼Œè°ƒè¯•é…ç½®é—®é¢˜ |
| `test-mqtt-storage.bat` | MQTTå­˜å‚¨æµ‹è¯• | æµ‹è¯•MQTTæœåŠ¡å™¨æ•°æ®å­˜å‚¨åŠŸèƒ½ |
| `test-web-data.bat` | Webæ•°æ®æµ‹è¯• | æµ‹è¯•Webæ¥å£æ•°æ®åŠŸèƒ½ |

## ğŸ”§ ä½¿ç”¨æµç¨‹

### å¼€å‘ç¯å¢ƒè®¾ç½®
```cmd
# 1. ç¯å¢ƒæ£€æŸ¥ä¸å®‰è£…
scripts\app\setup.bat

# 2. å¼€å‘æ¨¡å¼å¯åŠ¨
scripts\app\start-app.bat
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```cmd
# 1. æ„å»ºåº”ç”¨ç¨‹åº
scripts\app\build-app.bat

# 2. åˆå§‹åŒ–æ•°æ®åº“
scripts\database\init-database-sql.bat

# 3. é…ç½®é˜²ç«å¢™
scripts\firewall\configure_firewall.bat

# 4. è¿è¡Œåº”ç”¨ç¨‹åº
scripts\app\run-app.bat
```

### Dockerç¯å¢ƒéƒ¨ç½²
```cmd
# 1. å¯åŠ¨DockeræœåŠ¡
scripts\docker\docker-start.bat

# 2. åœæ­¢DockeræœåŠ¡
scripts\docker\docker-stop.sh
```

### æµ‹è¯•ä¸è°ƒè¯•
```cmd
# 1. è¿è¡Œå•å…ƒæµ‹è¯•
scripts\test\run-tests.bat

# 2. æµ‹è¯•é…ç½®
go run scripts\test\test-config.go

# 3. æµ‹è¯•MQTTåŠŸèƒ½
scripts\test\test-mqtt-storage.bat
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æƒé™è¦æ±‚
- **é˜²ç«å¢™è„šæœ¬**ï¼šéœ€è¦ç®¡ç†å‘˜æƒé™
- **Dockerè„šæœ¬**ï¼šéœ€è¦Docker Desktopè¿è¡Œ
- **æ•°æ®åº“è„šæœ¬**ï¼šéœ€è¦MySQLæœåŠ¡è¿è¡Œ

### ç¯å¢ƒä¾èµ–
- **Goç¯å¢ƒ**ï¼šGo 1.21æˆ–æ›´é«˜ç‰ˆæœ¬
- **MySQL**ï¼šMySQL 8.0æˆ–æ›´é«˜ç‰ˆæœ¬
- **Docker**ï¼šDocker Desktopï¼ˆå¯é€‰ï¼‰

### é…ç½®æ–‡ä»¶
- ç¡®ä¿ `config/config.yaml` ä¸­çš„æ•°æ®åº“é…ç½®æ­£ç¡®
- Dockeréƒ¨ç½²éœ€è¦ `config/config.docker.yaml`

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```cmd
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
scripts\database\check-database.bat

# é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
scripts\database\init-database-sql.bat
```

#### 2. é˜²ç«å¢™é—®é¢˜
```cmd
# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
powershell -ExecutionPolicy Bypass -File scripts\firewall\check_firewall_rules.ps1

# é‡æ–°é…ç½®é˜²ç«å¢™
scripts\firewall\configure_firewall.bat
```

#### 3. åº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥
```cmd
# æ£€æŸ¥é…ç½®
go run scripts\test\test-config.go

# é‡æ–°æ„å»º
scripts\app\build-app.bat
```

#### 4. Dockeré—®é¢˜
```cmd
# æ£€æŸ¥DockerçŠ¶æ€
docker info

# é‡å¯DockeræœåŠ¡
scripts\docker\docker-stop.sh
scripts\docker\docker-start.bat
```

## ğŸ“š æŠ€æœ¯è¯´æ˜

### è„šæœ¬ç‰¹æ€§
- **è·¨å¹³å°æ”¯æŒ**ï¼šæä¾›Windows (.bat) å’ŒLinux (.sh) ç‰ˆæœ¬
- **ä¸­æ–‡æ”¯æŒ**ï¼šä½¿ç”¨UTF-8ç¼–ç ï¼Œæ”¯æŒä¸­æ–‡æ˜¾ç¤º
- **é”™è¯¯å¤„ç†**ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- **ç”¨æˆ·å‹å¥½**ï¼šäº¤äº’å¼ç•Œé¢ï¼Œæ¸…æ™°çš„æ‰§è¡Œåé¦ˆ

### è·¯å¾„å¤„ç†
- **è‡ªåŠ¨æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹é¡¹ç›®æ ¹ç›®å½•
- **ç›¸å¯¹è·¯å¾„**ï¼šæ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„
- **ç›®å½•åˆ›å»º**ï¼šè‡ªåŠ¨åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„

### å®‰å…¨è€ƒè™‘
- **æƒé™æ£€æŸ¥**ï¼šæ£€æŸ¥å¿…è¦çš„ç³»ç»Ÿæƒé™
- **è¾“å…¥éªŒè¯**ï¼šéªŒè¯é…ç½®æ–‡ä»¶å’Œä¾èµ–
- **é”™è¯¯æ¢å¤**ï¼šæä¾›é”™è¯¯æ¢å¤æœºåˆ¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-09-07  
**æœ€åæ›´æ–°**: 2024-09-07  
**ä½œè€…**: ç©ºæ°”è´¨é‡ç›‘æµ‹ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ
